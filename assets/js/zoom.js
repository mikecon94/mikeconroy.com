!function(n){"use strict";function t(){this._activeZoom=this._initialScrollPosition=this._initialTouchPosition=this._touchMoveListener=null,this._$document=n(document),this._$window=n(window),this._$body=n(document.body),this._boundClick=n.proxy(this._clickHandler,this)}function h(t){this._fullHeight=this._fullWidth=this._overlay=this._targetImageWrap=null,this._targetImage=t,this._$body=n(document.body)}t.prototype.listen=function(){this._$body.on("click",'[data-action="zoom"]',n.proxy(this._zoom,this))},t.prototype._zoom=function(t){var o=t.target;if(o&&"IMG"==o.tagName&&!this._$body.hasClass("zoom-overlay-open"))return t.metaKey||t.ctrlKey?window.open(t.target.getAttribute("data-original")||t.target.src,"_blank"):void(o.width>=n(window).width()-h.OFFSET||(this._activeZoomClose(!0),this._activeZoom=new h(o),this._activeZoom.zoomImage(),this._$window.on("scroll.zoom",n.proxy(this._scrollHandler,this)),this._$document.on("keyup.zoom",n.proxy(this._keyHandler,this)),this._$document.on("touchstart.zoom",n.proxy(this._touchStart,this)),document.addEventListener?document.addEventListener("click",this._boundClick,!0):document.attachEvent("onclick",this._boundClick,!0),"bubbles"in t?t.bubbles&&t.stopPropagation():t.cancelBubble=!0))},t.prototype._activeZoomClose=function(t){this._activeZoom&&(t?this._activeZoom.dispose():this._activeZoom.close(),this._$window.off(".zoom"),this._$document.off(".zoom"),document.removeEventListener("click",this._boundClick,!0),this._activeZoom=null)},t.prototype._scrollHandler=function(t){null===this._initialScrollPosition&&(this._initialScrollPosition=n(window).scrollTop());var o=this._initialScrollPosition-n(window).scrollTop();40<=Math.abs(o)&&this._activeZoomClose()},t.prototype._keyHandler=function(t){27==t.keyCode&&this._activeZoomClose()},t.prototype._clickHandler=function(t){t.preventDefault?t.preventDefault():event.returnValue=!1,"bubbles"in t?t.bubbles&&t.stopPropagation():t.cancelBubble=!0,this._activeZoomClose()},t.prototype._touchStart=function(t){this._initialTouchPosition=t.touches[0].pageY,n(t.target).on("touchmove.zoom",n.proxy(this._touchMove,this))},t.prototype._touchMove=function(t){10<Math.abs(t.touches[0].pageY-this._initialTouchPosition)&&(this._activeZoomClose(),n(t.target).off("touchmove.zoom"))},h.OFFSET=80,h._MAX_WIDTH=2560,h._MAX_HEIGHT=4096,h.prototype.zoomImage=function(){var t=document.createElement("img");t.onload=n.proxy(function(){this._fullHeight=Number(t.height),this._fullWidth=Number(t.width),this._zoomOriginal()},this),t.src=this._targetImage.src},h.prototype._zoomOriginal=function(){this._targetImageWrap=document.createElement("div"),this._targetImageWrap.className="zoom-img-wrap",this._targetImage.parentNode.insertBefore(this._targetImageWrap,this._targetImage),this._targetImageWrap.appendChild(this._targetImage),n(this._targetImage).addClass("zoom-img").attr("data-action","zoom-out"),this._overlay=document.createElement("div"),this._overlay.className="zoom-overlay",document.body.appendChild(this._overlay),this._calculateZoom(),this._triggerAnimation()},h.prototype._calculateZoom=function(){this._targetImage.offsetWidth;var t=this._fullWidth,o=this._fullHeight,i=(n(window).scrollTop(),t/this._targetImage.width),e=n(window).height()-h.OFFSET,a=n(window).width()-h.OFFSET,s=t/o,r=a/e;this._imgScaleFactor=t<a&&o<e?i:s<r?e/o*i:a/t*i},h.prototype._triggerAnimation=function(){this._targetImage.offsetWidth;var t=n(this._targetImage).offset(),o=n(window).scrollTop()+n(window).height()/2,i=n(window).width()/2,e=t.top+this._targetImage.height/2,a=t.left+this._targetImage.width/2;this._translateY=o-e,this._translateX=i-a;var s="scale("+this._imgScaleFactor+")",r="translate("+this._translateX+"px, "+this._translateY+"px)";n.support.transition&&(r+=" translateZ(0)"),n(this._targetImage).css({"-webkit-transform":s,"-ms-transform":s,transform:s}),n(this._targetImageWrap).css({"-webkit-transform":r,"-ms-transform":r,transform:r}),this._$body.addClass("zoom-overlay-open")},h.prototype.close=function(){if(this._$body.removeClass("zoom-overlay-open").addClass("zoom-overlay-transitioning"),n(this._targetImage).css({"-webkit-transform":"","-ms-transform":"",transform:""}),n(this._targetImageWrap).css({"-webkit-transform":"","-ms-transform":"",transform:""}),!n.support.transition)return this.dispose();n(this._targetImage).one(n.support.transition.end,n.proxy(this.dispose,this)).emulateTransitionEnd(300)},h.prototype.dispose=function(){this._targetImageWrap&&this._targetImageWrap.parentNode&&(n(this._targetImage).removeClass("zoom-img").attr("data-action","zoom"),this._targetImageWrap.parentNode.replaceChild(this._targetImage,this._targetImageWrap),this._overlay.parentNode.removeChild(this._overlay),this._$body.removeClass("zoom-overlay-transitioning"))},n(function(){(new t).listen()})}(jQuery);
